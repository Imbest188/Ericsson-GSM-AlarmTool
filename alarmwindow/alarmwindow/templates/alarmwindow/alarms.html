<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Alarms</title>
    {% load static %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <link rel="stylesheet" href="{% static 'alarmwindow/css/table.css' %}">
    <script src="{% static 'alarmwindow/js/table-sort.js' %}"></script>

    <script>
        $(document).ready(function () {
            $('#update-form').submit(function () {
                $.ajax({
                    //data: $(this).serialize(), // получаем данные формы
                    type: $(this).attr('GET'), // GET или POST
                    url: "{% url 'alarms' %}",
                    success: function (response) {
                        $("#alarm_table tbody").html("");
                        $.each(response["alarms"], function (index, item) {
                            // language=HTML

                            $("#alarm_table tbody").prepend(
                                `<tr>
                                    <td class="coloredrow">${item["type"]}</td>
                                    <td>${item["date_time"].replace("-", ".").replace("-", ".").replace("T", " ")}</td>
                                    <td>${item["managed_object"]}</td>
                                    <td>${item["object_name"]}</td>
                                    <td>${item["slogan"]}</td>
                                    <td>${item["descr"]}</td>
                                </tr>`
                            )
                        });
                        $('td.coloredrow').each(function () {
                            var x = $(this).text();
                            if (x.includes("A1/")) $(this).css({background: '#ff7c73'});
                            else if (x.includes("A2/")) $(this).css({background: '#f58c5f'});
                            else if (x.includes("A3/")) $(this).css({background: '#fcd18b'});
                            else if (x.includes("O1/")) $(this).css({background: '#79a9fc'});
                            else if (x.includes("O2/")) $(this).css({background: '#8be8fc'});
                        });

                    },
                    error: function (response) {
                        // предупредим об ошибке
                        alert("Error");
                        console.log(response.responseJSON.errors)
                    }
                });
                return false;
            });
        })
    </script>

</head>
<body>
<form id="update-form">
    <div class="col text-center">
        <input type="submit" class="btn btn-primary" value="Update"/>
    </div>
</form>
<div>
    <table class="table-sort" id="alarm_table">
        <thead>
        <tr>
            <th>Type</th>
            <th>DateTime</th>
            <th>MO</th>
            <th>Name</th>
            <th>Description</th>
            <th>Slogan</th>
        </tr>
        </thead>
        <tbody>
        <!---{% for i in alarms %}
        <tr>
            {% if "A1/" in i.type %}
            <td class="red">{{i.type}}</td>
            {% endif %}
            {% if "A2/" in i.type %}
            <td class="orange">{{i.type}}</td>
            {% endif %}
            {% if "A3/" in i.type %}
            <td class="yellow">{{i.type}}</td>
            {% endif %}
            {% if "O2/" in i.type %}
            <td class="lightblue">{{i.type}}</td>
            {% endif %}
            {% if "O1/" in i.type %}
            <td class="blue">{{i.type}}</td>
            {% endif %}

            <td>{{i.date_time |date:'d.m.Y H:i:s'}}</td>
            <td>{{i.managed_object}}</td>
            <td>{{i.object_name}}</td>
            <td>{{i.slogan}}</td>
            <td>{{i.descr}}</td>
        </tr>
        {% endfor %}--->
        </tbody>
    </table>
</div>

</body>
</html>